{
	"title":"Deploying onesait Platform",
	"technologies":"HTML,GIT,DOCKER",
	"description":"This document explain how to create docker images of all the modules of the platform and how to execute it with Docker Compose",
	"detailedDescription":"More information about this topic can be found here \n\n[How to deploy onesait Platform](https://onesaitplatform.atlassian.net/wiki/spaces/OP/pages/43712636/Deployment+How+to+deploy+onesait+Cloud+Platform+locally+with+Docker+and+docker-compose)\n\nAnd here you can find resources\n\n[GIT onesait-platform-deploy] (https://github.com/onesaitplatform/onesait-cloud-platform-deploy)\n\nTo deploy the platform locally, we must consider the following pre-requirements:\n\n- Have _Docker_, Community Edition, locally installed\n\n- Have _Docker compose_ locally installed\n\n- _Add the platform's registry to Docker's registry list_\n\nOnce you have Docker installed and configured, you can download, configure and download the platform.\n\n1. **Download **docker-compose's files to launch the platform's services\nThese files, in yml format, are in the platform's repository in GitLab. To do it, you need to clone the repository locally, then place yourself in the develop branch.\n\n   > git clone https://github.com/onesaitplatform/onesait-cloud-platform-deploy.git\n\n   > cd onesait-cloud-platform-deploy\n\n   > git fetch origin master\n\n   > git checkout master\n\n2. **Launch **the persistence services\nPlace yourself in the same directory as the docker-compose.yml, in charge of launching the database services, is.\n\n   > cd onesait-cloud-platform-deploy/op-data\n\n   /.env\n\n   Check that the keys have the following values:\n\n   REPOSITORY            registry.onesaitplatform.com/\n\n   PERSISTENCE_TAG    latest\n\n   MODULE_TAG            1.0.0-rc22\n\n   MONGO_TAG            latest-noauth\n\n   /docker-compose.yml: if we want to launch the databases without persistence, then we run from a terminal the following command, from the same directory that the file is:\n\n   > docker-compose up -d\n\n   **IMPORTANT**: If the databases are launched ephemerally, when the services with docker-compose down are stopped, we will lose all the data.\n\n   /docker-compose.persistent.yml: if you want to persist the databases, then you must write in the .env file the directories of your machine where you want the data to be stored. There is no default assigned value. As an example, you can use:\n\n   REALTIME_VOLUME    /Users/devopsuser/realtimedbdata\n\n   CONFIGDB_VOLUME    /Users/devopsuser/configdbdata\n\n   SCHEDULERDB_VOLUME    /Users/devopsuser/schedulerdbdata\n\n   ELASTICDB_VOLUME    /Users/devopsuser/elasticdbdata\n\n   From the terminal, run the following command:\n\n   > docker-compose -f docker-compose.persistent.yml up -d\n\n   Once the databases have been launched, you can see the status of each with the following command:\n\n   > docker ps\n\n   If you want to see a database container log, you run:\n\n   > docker logs <container_name>\n\n   > docker logs -f <container_name> (-f equivale a un tail)\n\n3. **Populate **the databases with data\nIn that same directory (onesait-cloud-platform-deploy/op-data), there is another docker-compose file, in charge of launching the initial data load service. As you did previously, you can run:\n\n   > docker-compose -f docker-compose.initdb.yml up\n\n   In this case you do not include the -d flag (detached mode) because the service stops on its own once its task is over.\n\n4. **Launch the platform's modules**\nSame as we did with the persistence services, we launch the platform's different modules with docker-compose, ordered by start-up and in the directory onesait-cloud-platform-deploy/op-modules:\n\n   /router-cacheserver --> routing module and cache server.\n\n   /control-panel --> platform's web console.\n\n   /flowengine-iotbroker --> platform's IoT broker and flow engine.\n\n   /api-manager --> API Rest management module.\n\n   /oauth-server --> authentication server\n\n   /.env file with the following environment variables:\n\n   REPOSITORY    registry.onesaitplatform.com/ \n\n   a registry containing the service's image.\n\n"}