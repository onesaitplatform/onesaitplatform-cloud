<!--

    Copyright Indra Soluciones Tecnologías de la Información, S.L.U.
    2013-2019 SPAIN

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at
         http://www.apache.org/licenses/LICENSE-2.0
    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<html xmlns:th="http://www.thymeleaf.org"  th:with="lang=${#locale.language}" th:lang="${lang}">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
		<meta http-equiv="Content-Language" th:content="${lang}"/>
		<title th:text="#{name.app}"/>

		
		<!-- STYLE SHEETS -->
		<link rel="stylesheet" type="text/css" media="all" th:href="@{/static/css/bootstrap.min.css}"/>
		<link rel="stylesheet" type="text/css" media="all" th:href="@{/static/css/components.css}"/>
		<link rel="stylesheet" type="text/css" media="all" th:href="@{/static/css/plugins.css}"/>
		<link rel="stylesheet" type="text/css" media="all" th:href="@{/static/css/layout.css}"/>
		<!-- THEME -->
		<link rel="stylesheet" type="text/css" media="all" th:href="@{/static/webjars/sofia2_theme/css/sofia2.css}"/>		
		
		<!-- PLUGINS -->
		<link rel="stylesheet" type="text/css" media="all" th:href="@{/static/vendor/datatable/datatables.bootstrap.css}"/>	
		<!-- JSON EDITOR -->
		<link rel="stylesheet" type="text/css" media="all" th:href="@{/static/vendor/json/jsoneditor.css}"/>
		<link rel="stylesheet" type="text/css" media="all" th:href="@{/static/vendor/codemirror/lib/codemirror.css}"/>
		<link rel="stylesheet" type="text/css" media="all" th:href="@{/static/vendor/codemirror/theme/neat.css}"/>
		<link rel="stylesheet" type="text/css" media="all" th:href="@{/static/vendor/codemirror/theme/ambiance.css}"/>
		<link rel="stylesheet" type="text/css" media="all" th:href="@{/static/vendor/codemirror/theme/material.css}"/>
		<link rel="stylesheet" type="text/css" media="all" th:href="@{/static/vendor/codemirror/theme/neo.css}"/>
		
	</head>	
	
	<!-- page-sidebar-closed to START WITH MENU COLLAPSED. -->
	<body class="page-header-fixed  page-content-white page-sidebar-closed">

	<!-- MAIN PAGE WRAPPER -->
	<div class="page-wrapper">
	
		<!-- BEGIN HEADER INCLUDE -->
		<div th:include="fragments/header::#headerFragment" class="page-header navbar navbar-fixed-top"></div>
		<!-- END HEADER -->
		
		<!-- HEADER AND CONTENT DIVIDER -->
		<div class="clearfix"> </div>
			
		<!-- BEGIN SIDEBAR INCLUDE (MENU) -->
		<div th:include="fragments/menu::#menuFragment" class="page-sidebar-wrapper"></div>
		<!-- END SIDEBAR -->
			
		<!-- BEGIN CONTENT -->
		<div class="page-content-wrapper">
			
			<!-- BEGIN CONTENT BODY -->
			<div class="page-content">
			
                <div class="alert alert-success display-hide">
					<span th:text="${globalMessage}"></span>
				</div>		
				
				<!-- BEGIN PAGE BAR AND BREADCRUM-->
				<div class="page-bar margin-bottom-20">
					<ul class="page-breadcrumb">
						<li><a th:href="@{/}">Home</a><i class="fa fa-angle-right"></i></li>
						<li><a th:href="@{/ontologies/list}"> <span th:text="#{ontology.breadcrumb.list}">Ontologies </span></a><i class="fa fa-angle-right"></i></li>
						<li>
							<span th:text="#{ontology.breadcrumb.show}">Show Ontology</span>							
						</li>
					</ul>						
				</div>
				<!-- END PAGE BAR -->
				
				<!-- BEGIN PAGE TITLE-->
				<h1 class="page-title hide "><span th:text="#{name.app}"> Onesait Platform Control Panel</span></h1>
				<!-- END PAGE TITLE-->			
				
				<!-- MAIN ROW -->
				<div class="row">
					<div class="col-md-12">						
						<div class="portlet light">
							<div class="portlet-title tabbable-line">
								<div class="caption">
									
								</div>									
								<div class="tools hide">
									<a href="" class="collapse" data-original-title="" title=""> </a>																			
									<a href="" class="fullscreen" data-original-title="" title=""> </a>										
								</div>
								
								<!-- SECCIONES DE LA ONTOLOGIA TABS -->
								<ul class="nav nav-tabs pull-left">
									<li id="tab-datos" class="active"><a href="#tab_1" data-toggle="tab" aria-expanded="false">	<span class="caption-subject " th:text="#{ontology.template.show} + ' ' + ${ontology.identification}"> Ontology Identification</span></a></li>
									<li id="tab-autorizaciones" class=""><a href="#tab_2" data-toggle="tab" th:classappend="${ontology?.id} == null ? disabled : ''" aria-expanded="true"><span th:text="#{ontology.list.auth}">AUTORIZACIONES </span></a></li>
									<li id="tab-advanced-options" class=""><a href="#tab_settings" data-toggle="tab" aria-expanded="true"><span th:text="#{ontology.advancedsettings}" >Advanced Settings </span></a></li>
								    <li id="tab-kpi" class=""><a  th:style="${ontology.ontologyKPI} == null ? 'display:none' : 'display:block'" href="#tab_kpi" data-toggle="tab" aria-expanded="true"> <span  th:text="#{ontology.kpisettings}" >KPI Settings </span></a></li>
								    <li id="tab-tseries" class =""><a th:style="${ontology.dataModel.id} != 'MASTER-DataModel-30' ? 'display:none' : 'display:block'" href="#tab_tseries" data-toggle="tab" aria-expanded="false">	<span th:text="#{ontology.tseriessettings}"> Timeseries Settings</span></a></li>
								</ul>
								
							</div>
							<div class="portlet-body" style="display: block; height: auto;">
								
								<div class="tab-content">
									<div class="tab-pane active" id="tab_1">
									<!-- VIEW -->
										<div class="row">
											<div class="col-md-12 alert-zone"><!-- ALERTS ZONE -->																
											</div>
											<div class="col-md-12">										
												<form role="form" id="ontology_view_form" action="show.html" th:object="${ontology}" th:action="@{|/controlpanel/ontologies/${id}|}"  method="post" class="form">
													<div class="form-body">
														<!-- ontology, id , identification -->
														<div class="row">													
															<div class="col-md-6 col-sm-6 col-xs-12">
																<div class="form-group">
																	<label class="control-label" th:text="#{ontology.identification} + ':'">Name</label>
																	<p class="form-control-static-block " th:text="*{identification}"> ontology Name </p>
																</div>
															</div>
															<div class="col-md-6 col-sm-6 col-xs-12">
																<div class="form-group">
																	<label class="control-label"><span th:text="#{ontology.metainf} + ':'">Meta Information</span></label>
																	<p class="form-control-static-block " th:text="*{metainf}"> meta </p>
																</div>
															</div>													
														</div>
														<!-- Role, created-at, removed-at -->
														<div class="row">
															<div class="col-md-3 col-sm-6 col-xs-12">
																<div class="form-group">
																	<label class="control-label" th:text="#{ontology.datamodel} + ':'">Datamodel Template</label>
																	<p class="form-control-static-block " th:text="*{dataModel?.identification} "> datamodel </p>
																</div>
															</div>
															<div class="col-md-3 col-sm-6 col-xs-12">
																<div class="form-group">
																	<label class="control-label" th:text="#{ontology.datamodel.type} + ':'">Datamodel Type</label>
																	<p class="form-control-static-block " th:text="*{dataModel?.type} "> datamodel type </p>
																</div>
															</div>
															<div class="col-md-3 col-sm-6 col-xs-12" >
																<div class="form-group">
																	<label class="control-label" th:text="#{ontology.active} + '?'">Active</label>
																	<p class="form-control-static-block static-blank ">
																		<span th:if="*{active}"><i class="la la-check-circle-o text-success font-hg"></i></span>
																		<span th:if="!*{active}"><i class="la la-times-circle-o text-danger font-hg"></i></span>
																	</p>
																</div>
															</div>
															<div class="col-md-3 col-sm-6 col-xs-12" >
																<div class="form-group">
																	<label class="control-label" th:text="#{ontology.public} + '?'">Public</label>
																	<p class="form-control-static-block static-blank ">
																		<span th:if="*{public}"><i class="la la-check-circle-o text-success font-hg"></i></span>
																		<span th:if="!*{public}"><i class="la la-times-circle-o text-danger font-hg"></i></span>
																	</p>
																</div>
															</div>
														</div>
														<div class="row">
															<div class="col-md-6 col-sm-12 col-xs-12" >
																<div class="form-group">
																	<label class="control-label" th:text="#{ontology.description} + ':'">Description</label>
																	<p class="form-control-static-block " th:text="*{description}"> description </p>
																</div>
															</div>
															<div class="col-md-3 col-sm-6 col-xs-12" >
																<div class="form-group">
																	<label class="control-label" th:text="#{ontology.rtdbclean} + '?'">rtdbclean</label>
																	<p class="form-control-static-block static-blank ">																		
																		<span th:if="*{rtdbClean}"><i class="la la-check-circle-o text-success font-hg"></i></span>
																		<span th:if="!*{rtdbClean}"><i class="la la-times-circle-o text-danger font-hg"></i></span>
																	</p>
																</div>
															</div>
															<!-- 
															<div class="col-md-3 col-sm-6 col-xs-12" >
																<div class="form-group">
																	<label class="control-label" th:text="#{ontology.rtdbtohdb} + '?'">rtdbtohdb</label>
																	<p class="form-control-static-block static-blank bold">
																		<span th:if="*{rtdbToHdb}"  class="label label-sm label-success"><i class="fa fa-check"></i></span>
																		<span th:if="!*{rtdbToHdb}" class="label label-sm label-danger" title="NO"><i class="fa fa-warning"></i></span>
																	</p>
																</div>
															</div> -->
															<div class="col-md-3 col-sm-6 col-xs-12" >
																<div class="form-group">
																	<label class="control-label" th:text="#{ontology.allowsCypherFields} + '?'">Allow Encription of Fields</label>
																	<p class="form-control-static-block static-blank ">																		
																		<span th:if="*{allowsCypherFields}"><i class="la la-check-circle-o text-success font-hg"></i></span>
																		<span th:if="!*{allowsCypherFields}"><i class="la la-times-circle-o text-danger font-hg"></i></span>
																	</p>
																</div>
															</div>
														</div>
														<div class="row">																																
															<div class="col-md-12 col-sm-12 col-xs-12">
																<div class="form-group">
																	<label class="control-label"> <span th:text="#{ontology.schema}">Ontology Schema</span></label>														
																	<div id="jsoneditor"></div>	
																	<div class="clearfix"></div>
																	<div class="col-md-12 col-xs-12" style="padding-top: 25px;">
																		<textarea class="form-control" id="ontology_instance" name="ontology_instance" readOnly="readonly"  cols="" rows=""></textarea>
																	</div>
																</div>
															</div>
														</div>
													</div>
													<!-- FORM BUTTONS -->
													<div class="form-actions">
														
														<div class="pull-left">
															<!-- CANCEL TO-DO: authentication and control -->
															<button th:if="${#strings.arrayJoin(#authentication.authorities,'')} == 'ROLE_ADMINISTRATOR'" id="cancelBtn" type="button" class="btn btn-circle btn-outline blue no-border" name="cancel"  th:value="#{gen.cancelBtn}" value="cancel" th:onclick="'javascript:navigateUrl(\'' + @{/ontologies/list} + '\');'"><i class="la la-arrow-left"></i><span th:text="#{gen.cancelBtn}"> Cancel </span></button>
															<button th:if="${#strings.arrayJoin(#authentication.authorities,'')} != 'ROLE_ADMINISTRATOR'" id="cancelBtn" type="button" class="btn btn-circle btn-outline blue no-border" name="cancel"  th:value="#{gen.cancelBtn}" value="cancel" th:onclick="'javascript:navigateUrl(\'' + @{/} + '\');'"><i class="la la-arrow-left"></i><span th:text="#{gen.cancelBtn}"> Cancel </span></button>
														</div>
														<div class="pull-right">
															
															<!-- REMOVE -->
															<button sec:authorize="!hasAuthority('ROLE_PARTNER')" id="deleteBtn" type="button" class="btn btn-circle btn-outline blue" name="delete"  value="Remove" th:onclick="'deleteOntologyConfirmation(\'' + ${ontology.id} + '\');'" ><span th:text="#{gen.deleteBtn}"> Delete </span></button>

															<span class="sep no-border">&nbsp;</span>
															
															
															<!-- MODIFY TO-DO: == and != has the same onClick? check! -->
															<button sec:authorize="hasAuthority('ROLE_ADMINISTRATOR')" th:if="${'MASTER-DataModel-30' != ontology.dataModel.id}" id="editBtn" type="button" class="btn btn-circle btn-outline blue" name="edit"  value="Edit" th:onclick="'javascript:navigateUrl(\'' + @{|/ontologies/update/${ontology.id}/|} + '\');'" ><span th:text="#{gen.editBtn}"> Edit </span></button>
	 														<button sec:authorize="!hasAuthority('ROLE_PARTNER') AND !hasAuthority('ROLE_ADMINISTRATOR')" th:if="${#authentication.name} == ${ontology.user.userId} AND ${'MASTER-DataModel-30' != ontology.dataModel.id}" id="editBtn" type="button" class="btn btn-circle btn-outline blue" name="edit"  value="Edit" th:onclick="'javascript:navigateUrl(\'' + @{|/ontologies/update/${ontology.id}/|} + '\');'" ><span th:text="#{gen.editBtn}"> Edit </span></button>															
															<button sec:authorize=" hasAuthority('ROLE_PARTNER')" th:if="${'MASTER-DataModel-30' != ontology.dataModel.id}" id="editBtn" type="button" class="btn btn-square btn-warning" name="edit"  value="Edit" th:onclick="'javascript:navigateUrl(\'' + @{/ontologies/update/} + ${ontology.id} + '\');'" ><i class="la la-edit"></i> <span th:text="#{gen.editBtn}"> Edit </span></button>

															<button sec:authorize="hasAuthority('ROLE_ADMINISTRATOR')" th:if="${'MASTER-DataModel-30' == ontology.dataModel.id}" id="editBtn" type="button" class="btn btn-circle btn-outline blue" name="edit"  value="Edit" th:onclick="'javascript:navigateUrl(\'' + @{|/ontologies/updatetimeseries/${ontology.id}/|} + '\');'" ><span th:text="#{gen.editBtn}"> Edit </span></button>
	 														<button sec:authorize="!hasAuthority('ROLE_PARTNER') AND !hasAuthority('ROLE_ADMINISTRATOR')" th:if="${#authentication.name} == ${ontology.user.userId} AND ${'MASTER-DataModel-30' == ontology.dataModel.id}" id="editBtn" type="button" class="btn btn-circle btn-outline blue" name="edit"  value="Edit" th:onclick="'javascript:navigateUrl(\'' + @{|/ontologies/updatetimeseries/${ontology.id}/|} + '\');'" ><span th:text="#{gen.editBtn}"> Edit </span></button>															
															<button sec:authorize=" hasAuthority('ROLE_PARTNER')" th:if="${'MASTER-DataModel-30' == ontology.dataModel.id}" id="editBtn" type="button" class="btn btn-square btn-warning" name="edit"  value="Edit" th:onclick="'javascript:navigateUrl(\'' + @{/ontologies/updatetimeseries/} + ${ontology.id} + '\');'" ><i class="la la-edit"></i> <span th:text="#{gen.editBtn}"> Edit </span></button>

															
															<span class="sep">&nbsp;</span>
															
															<!-- CREATE -->
															<button sec:authorize="!hasAuthority('ROLE_PARTNER')" th:if="${#strings.arrayJoin(#authentication.authorities,'')} == 'ROLE_ADMINISTRATOR'" id="createBtn" type="button" class="btn btn-circle btn-outline btn-primary" name="create"  value="Create" th:onclick="'javascript:navigateUrl(\'' + @{/ontologies/} + 'create' + '\');'" ><span th:text="#{gen.createBtn}"> New</span></button>
															
														</div>
													</div>											
												<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" /></form>
												
												<!-- AUXILIAR FORM TO DELETE ontology -->
												<form id="delete_ontology_form" class="delete-ontology hide"  action=""  method="post">
													<input type="hidden" name="_method" value="DELETE"/>
													<input id="delete-ontologyId" type="hidden" name="ontologyId" th:value="*{id}"/>
												<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" /></form>
											</div>									
										</div>
									</div>
									<div class="tab-pane " id="tab_2">
									<!-- AUTHORIZATIONS -->
										<div class="row">
											<div class="col-md-12">											
												<div id="contenedor-tabla-outside" class="contiene margin-bottom-30">																						
													<div>
														<!-- DATATABLE DANDELION CONF. -->												
														<table id="authorizations" class="table table-hover table-striped" dt:table="true" dt:paginationtype="full_numbers">
															<thead>
																<tr class="cabecera-tabla">
																	<th class="titulo-columnas text-left" th:text="#{ontology.auth.user}">Identification</th>
																	<th class="titulo-columnas text-left" ><span th:text="#{ontology.auth.userfullname}" >User</span></th>
																	<th class="titulo-columnas text-center" th:text="#{ontology.auth.accesstype}">Description</th>
																</tr>
															</thead>
															<tbody th:remove="all-but-first">
																<tr th:each="authorization : ${authorizations}" pages:paginate="10">
																	<!-- IDENTIFICATION/NAME -->
																	<td class="text-left no-wrap bold" th:text="${authorization.userId}"></td>
																	<!-- USER -->
																	<td class="text-left " th:text="${authorization.userFullName}"></td>
																	<!-- ACCESS TYPE  -->
																	<td class="text-center " th:text="${authorization.typeName}"></td>																
																</tr>
															</tbody>
														</table>												
														<!-- TABLE COLUMNS CONTAINER SHOW/HIDE -->
														<div id="dataTable-vis-toggle" class="btn-group margin-left-10 hide">
															<a href="javascript:;" data-toggle="dropdown" aria-expanded="false" class="btn btn-square btn-sm btn-default ">
																<span th:text="#{gen.columns}">Columns</span> <i class="fa fa-angle-down"></i>
															</a>
															<div id="column_toggler" data-container="body" class="dropdown-menu hold-on-click dropdown-checkboxes pull-right">
																<label class="toggle-vis" data-column="0" th:text="#{ontology.auth.user}"> Identification </label>
																<label class="toggle-vis" data-column="1" th:text="#{ontology.auth.userfullname}"> User </label>
																<label class="toggle-vis" data-column="2" th:text="#{ontology.auth.accesstype}"> Access Type</label>															
															</div>
														</div>												
													</div>
												</div>											
											</div>
										</div>
									</div>
									<!-- ONTOLOGY ADVANCED SETTINGS -->
									<div class="tab-pane " id="tab_settings">
										<div class="row">
											<div class="col-md-6 col-sm-6 col-xs-12">
												<div class="form-group">
													<label class="control-label" th:text="#{ontology.rtdbinstance}">Rtdb instance</label>
													<p id="pDatas" class="form-control-static-block " th:text="${ontology.rtdbDatasource}"> Rtdb instance </p>
												</div>
												<div th:if="${ontology.rtdbClean}" class="form-group">
													<label class="control-label" th:text="#{ontology.clean.options}">Cleanse Options</label>
													<p id="pClean" class="form-control-static-block " th:text="${ontology.rtdbCleanLapse == null ? 'NEVER' : ontology.rtdbCleanLapse }"> Rtdb instance </p>
												</div>
												<div class="form-group">
													<label class="control-label" th:text="#{ontology.rtdb2h}">RTDB to historic</label>
													<p th:if="${ontology.rtdbToHdb}" class="form-control-static-block " th:text="#{gen.yes}"> Yes </p>
													<p th:if="${not ontology.rtdbToHdb}"  class="form-control-static-block " th:text="#{gen.no}"> No </p>
												</div>
												<div th:if="${ontology.rtdbToHdb}" class="form-group">
													<label class="control-label" th:text="#{ontology.storage}">Storage</label>
													<p  class="form-control-static-block " th:text="${ontology.rtdbToHdbStorage}"> Storage mode </p>
												</div>
												<div class="form-group">
													<label class="control-label" th:text="#{ontology.allowsCreateTopic}">Kafka</label>
													<p th:if="${ontology.allowsCreateTopic}" id="allowsCreateTopic" class="form-control-static-block " th:text="#{gen.yes}"> Kafka </p>
													<p th:if="${not ontology.allowsCreateTopic}" id="allowsCreateTopic" class="form-control-static-block " th:text="#{gen.no}"> Kafka </p>
												</div>
												
											</div>								
										</div>	
									</div>
									<!-- TAB KPI  -->
									<div class="tab-pane " id="tab_kpi">
									<div class="row">
												<div class="col-md-12 col-sm-12 col-xs-12">
																<div class="form-group">
																	<label th:text="#{ontology.kpi.query}">QUERY: </label><span
																		class="required"> *</span>
																	<textarea th:tabindex="4" rows="7" 
																		class="element textarea small form-control" id="query"
																		name="query" th:field="${ontology.ontologyKPI.query}"
																		 cols="" readOnly="readonly" ></textarea>
																</div>
															</div>															
									</div>	
									<div class="row">
										        <div class="col-md-4 col-sm-4 col-xs-12">
												      <div class="form-group">
																	<label  class="control-label" th:text="#{ontology.kpi.cron} + ':'">CRON</label>																
																	<p class="form-control-static-block " th:text="${ontology.ontologyKPI.cron}">  </p>
														</div>
															</div>
															<div class="col-md-4 col-sm-4 col-xs-12">
															<div class="form-group">
															<label  class="control-label" th:text="#{ontology.kpi.date.from} + ':'">ACTIVATED
																	FROM </label>																
																	<p class="form-control-static-block " th:text="${ontology.ontologyKPI.dateFrom}"></p>
															</div>	
															</div>
															<div class="col-md-4 col-sm-4 col-xs-12">
															<div class="form-group">
															<label class="control-label" th:text="#{ontology.kpi.date.to}">ACTIVATED
																	TO </label>												
																	<p class="form-control-static-block " th:text="${ontology.ontologyKPI.dateTo}"></p>
															</div>	
															</div>
														</div>
														
									<div th:if="${ontology.ontologyKPI.postProcess} != ''" class="row" style="display: inline; size:auto">
									    <div class="portlet light">
									    	<div class="portlet-title">
												<div class="caption">
													 <!--FORM TITLE -->
													<span class="inline font-s uppercase" th:text="#{ontology.kpi.postProcess} +':'">Post Process </span>
												</div>														
											</div>
											<div id="portletBody" class="portlet-body" style="height: auto;">
													<textarea id="postProcess" name="postProcess" th:field="*{ontology.ontologyKPI.postProcess}" class="form-control"></textarea>
										 	</div>
										</div>
									</div>
														
										<!-- END TAB KPI  -->
										
									</div>
									
									<!-- TAB TIMESERIES  -->
									<div class="tab-pane " id="tab_tseries">
										<div class="row">
											<div class="col-md-6 col-sm-12 col-xs-12">
												<label class="control-label" th:text="#{ontology.timeseries.tags}">Tags</label>
												<div id="template_schema" class="margin-bottom-20 ">
													<table class="table table-light table-hover table-striped" id="tag_properties"
															data-loaded="false">
														<thead>
															<tr class="cabecera-tabla" role="row">
																<th class="titulo-columnas"><label
																	id="label_available" class="description"
																	th:text="#{ontology.timeseries.name}">Name</label></th>
																<th class="titulo-columnas"><label
																	id="label_available" class="description"
																	th:text="#{ontology.timeseries.type}">Type
																</label></th>
																
															</tr>
														</thead>
														<tbody>
															<tr class="tagRow" th:each="tsprop :${ontologyTSDTO.timeSeriesProperties}" th:if="${#strings.endsWith(tsprop.propertyType,'TAG')}"	>
																<td
																th:text="${tsprop.propertyName}" >A</td> 
																<td 
																th:text="${tsprop.propertyDataType}" >STRING</td> 
															</tr>
														</tbody>
														<tfoot>
															<tr>
																<td colspan="4"></td>
															</tr>
														</tfoot>
													</table>
												</div>
											</div>		
											<div class="col-md-6 col-sm-12 col-xs-12">
												<label class="control-label" th:text="#{ontology.timeseries.fields}">Fields</label>
												<div id="template_schema" class="margin-bottom-20 ">
													<table class="table table-light table-hover table-striped" id="field_properties"
															data-loaded="false">
														<thead>
															<tr class="cabecera-tabla" role="row">
																<th class="titulo-columnas"><label
																	id="label_available" class="description"
																	th:text="#{ontology.timeseries.name}">Name</label></th>
																<th class="titulo-columnas"><label
																	id="label_available" class="description"
																	th:text="#{ontology.timeseries.type}">Type
																</label></th>
																
															</tr>
														</thead>
														<tbody>
															<tr class="fieldRow" th:each="tsprop :${ontologyTSDTO.timeSeriesProperties}" th:if="${#strings.endsWith(tsprop.propertyType,'FIELD')}"	>
																<td
																th:text="${tsprop.propertyName}" >A</td> 
																<td 
																th:text="${tsprop.propertyDataType}" >STRING</td> 
															</tr>
														</tbody>
														<tfoot>
															<tr>
																<td colspan="4"></td>
															</tr>
														</tfoot>
													</table>
												</div>
											</div>														
										</div>	
										
										<div class="row">
											<div class="col-lg-12 col-md-12 col-xs-12">
												<label th:text="#{ontology.timeseries.config}">Configuration MongoDB</label>
												<div id="template_schema" class="margin-bottom-20 ">
													<table class="table table-light table-hover table-striped" id="window_properties"
														data-loaded="false">
														<thead>
															<tr class="cabecera-tabla" role="row">
																<th class="titulo-columnas"><label
																	id="label_available" class="description"
																	th:text="#{ontology.timeseries.window}">Window</label></th>
																<th class="titulo-columnas"><label
																	id="label_available" class="description"
																	th:text="#{ontology.timeseries.frequency}">Frequency
																</label></th>
																<th class="titulo-columnas"><label
																	id="label_available" class="description"
																	th:text="#{ontology.timeseries.aggregate}">Aggregate
																</label></th>
																<th class="titulo-columnas"><label
																	id="label_available" class="description"
																	th:text="#{ontology.timeseries.delpolicy}">Deletion policy
																</label></th>
															</tr>
														</thead>
														<tbody>
															<tr class="WindowRow" th:each="tswind :${ontologyTSDTO.timeSeriesWindow}" >
																<td th:text="${tswind.windowType}" ></td> 
																<td 
																	th:text="${tswind.frecuency} + ' ' + ${tswind.frecuencyUnit}" ></td> 
																<td 
																	th:text="${tswind.aggregationFunction}" ></td> 
																<td th:if="${tswind.retentionBefore}!=null"
																	th:text="${tswind.retentionBefore} + ' ' + ${tswind.retentionUnit}" ></td> 
																<td th:if="${tswind.retentionBefore}==null">No</td>
															</tr>
														</tbody>
														<tfoot>
															<tr>
																<td colspan="4"></td>
															</tr>
														</tfoot>
													</table>
												</div>
											</div>									
										</div>	
																		
										<!-- END TAB TIMESERIES  -->
										
									</div>
									
								</div>
								
							</div>
						</div><!-- END PORTLET BASIC  -->						
					</div><!-- END COL-12 -->						
				</div><!-- END MAIN ROW -->
			</div><!-- END CONTENT BODY -->
		</div><!-- END CONTENT page-content-wrapper -->		
	</div>
	<!-- END MAIN PAGE WRAPPER -->
	
	<!-- FOOTER INCLUDE -->
	<footer th:include="fragments/footer::#footerFragment" class="page-footer"> </footer>
	
	<!-- CORE JS CONTROLLERS -->
	<script th:src="@{/static/js/app.js}"/>
	<script th:src="@{/static/js/layout.js}"/>

	<!-- PLUGINS -->
	<script th:src="@{/static/vendor/jquery/jquery.dataTables.min.js}"/>
	<script th:src="@{/static/vendor/datatable/datatables.bootstrap.js}"/>	
	<script th:src="@{/static/vendor/codemirror/lib/codemirror.js}"/>
	<script th:src="@{/static/vendor/codemirror/mode/javascript/javascript.js}" />
	<script th:src="@{/static/vendor/codemirror/addon/edit/matchbrackets.js}" />
	<script th:src="@{/static/vendor/codemirror/addon/edit/closebrackets.js}" />
	<script th:src="@{/static/vendor/codemirror/addon/selection/active-line.js}" />
	<script th:src="@{/static/vendor/codemirror/addon/comment/comment.js}" />
	<script th:src="@{/static/vendor/codemirror/addon/comment/continuecomment.js}" />
	
	<!-- JSON EDITOR -->	
	<script th:src="@{/static/vendor/json/jsoneditor.js}"/>
	
	<script th:src="@{/static/vendor/ace/ace.js}" charset="utf-8"/>
	<script th:src="@{/static/vendor/ace/mode-json.js}"/>
	<script th:src="@{/static/vendor/ace/theme-textmate.js}"/>
	
	<!-- TEMPLATE CONTROLLER  -->	
		
	<!-- MAIN INIT -->
	<script  th:inline="javascript">
	var showLog = 1; // console.log toggle
    //<![CDATA[ 
	
	
	// DATATABLES LANGUAJE FROM PROPERTIES.
	datatable_lang = [[#{datatables_lang}]];	
	var languageJson = JSON.parse(datatable_lang);
	if ( languageJson ){ $.extend( true, $.fn.dataTable.defaults, { language: languageJson }); }
	

	var stringSchema = [[${ontology.jsonSchema}]];
	var jsonSchema = JSON.parse(stringSchema);

	// REDIRECT
	function navigateUrl(url){  window.location.href = url;	}
	
	// DELETE ontology
	function deleteOntologyConfirmation(ontologyId){
		showLog ? console.log('deleteOntologyConfirmation() -> formId: '+ ontologyId): '';
		
		// no Id no fun!
		if ( !ontologyId ) {$.alert({title: 'ERROR!',type: 'red' , theme: 'dark', content: 'NO ontology-FORM SELECTED!'}); return false; }
		
		// set action and ontologyId to the form
		$('#delete-ontologyId').attr('ontologyId',ontologyId);
		$('.delete-ontology').attr('action','/controlpanel/ontologies/' + ontologyId);
		showLog ? console.log('deleteOntologyConfirmation() -> formAction: ' + $('.delete-ontology').attr('action') + ' ID: ' + $('#delete-ontologyId').attr('ontologyId')): '';
		
		// call ontology Confirm at header.
		HeaderController.showConfirmDialogOntologia('delete_ontology_form');	
	}
	
	// CHECK IF JSON STRING WHEN JSON PARSE IS OK OR NOT, IF THE JSON IS
	// MALFORMED THE JSON.parse() is broken.
	var IsJsonString = function(str) {
		try {
			JSON.parse(str);
		}
		catch (e) {	return false; }

		return true;
	}
	
	// GENERATE EACH PROPERTY FOR ONTOLOGY INSTANCE.
	var generateProperty = function(propertyName, property, instance){
		showLog ? console.log('    |--->   generateProperty()') : '';
		var thevalue = "";

		// if has internalID (oid) we generate it.
        if ( propertyName == "$oid") {
            hasId = true;
            if ( property.type == "string") { instance = instance + "\"$oid\":\"53b281b1c91cbd35025e3d91\""; }
            instance = instance + ",";
        }
		else {
			// if not oid, we treat the property
            instance = instance + "\"" + propertyName + "\":"; // adding name

            var tipo = property.type; // adding type
            if (tipo.includes("geometry")){ instance = instance + generateBasicType(tipo, "", "");
            // adding object type
            } else if (tipo.toLowerCase() == "object"){ console.log('INSTANCE (obj): ' + instance); instance = instance + generateObject(property, "", propertyName);
			// adding array type
            } else if (tipo.toLowerCase() == "array" ){ console.log('INSTANCE (arr): ' + instance); instance = instance + generateArray(property, "", propertyName);
            // timestamp
            } else if (tipo.toLowerCase() == "string" && property.format != null){
            	instance = instance +"\"2014-01-30T17:14:00Z\""; 
            // else basic type
            } else {
                thevalue = "";
                // if enum type, get first value of enum.
                if ( property.enum != null ){ thevalue = property.enum[0]; }
                instance = instance + generateBasicType(tipo, "", "", thevalue);
            }
            instance = instance + ",";
        }
        return instance;
    }
	
	// GENERARATE PROPERTY TYPES [GEOMETRY, OBJECT, ARRAY OR BASIC]
	var generateBasicType = function(propType, obj, parent, thevalue){
		showLog ? console.log('        |--->   generateBasicType()') : '';

    	// if enum, return enum value
    	if (thevalue != null && thevalue != ""){ return "\"" + thevalue + "\""; }
    	// string
        if (propType == "string") {
        	if 		(parent == "media" && obj == "storageArea")	  { return "\"SERIALIZED\""; }
			else if (parent == "media" && obj == "binaryEncoding"){ return "\"Base64\""; }
			else if (parent == "media" && obj == "name")		  {	return "\"fichero.pdf\""; }
			else if (parent == "media" && obj == "mime")		  {	return "\"application/pdf\""; }
			else{ return "\"string\""; }
        }
		// integer,boolean, object, number and geometry
		else if ( propType == "integer" ){ return "1" }
		else if ( propType == "boolean" ){ return "true"; }
		else if ( propType == "object" ){ return "{}"; }
		else if ( propType == "geometry-point" || obj =="geometry-point"){ return "{\"type\":\"Point\", \"coordinates\":[9,19.3]}"; }
		else if ( propType == "geometry-linestring" || obj =="geometry-linestring"){ return "{\"type\":\"LineString\", \"coordinates\":[[9,19.3],[19,9.3]]}"; }
		else if ( propType == "geometry-polygon" || obj =="geometry-polygon"){ return "{\"type\":\"Polygon\", \"coordinates\":[ [[9,-19.3],[-19,-9.3],[-9,19.3],[19,-9.3]] ,[[9,19.3],[19,9.3],[-9,19.3],[-19,9.3]] ]}"; }
		else if ( propType == "geometry-multipoint" || obj =="geometry-multipoint"){ return "{\"type\":\"MultiPoint\", \"coordinates\":[[9,19.3],[19,19.3]]}"; }
		else if ( propType == "geometry-multilinestring" || obj =="geometry-multilinestring"){ return "{\"type\":\"MultiLineString\", \"coordinates\":[ [[9,19.3],[19,9.3]], [[9,19.3],[19,9.3]] ]}"; }
		else if ( propType == "geometry-multipolygon" || obj =="geometry-multipolygon"){ return "{\"type\":\"MultiPolygon\", \"coordinates\":[[[[9,2.5],[9,2],[-9,3],[9,-3],[-9,2]]],[[[9,0],[9,-0.5],[9,-1.5],[9,1],[9,0.4]],[[9,0.2],[-9,0.2],[9,0.8],[-9,0.8],[9,3.2]]]]}"; }
		else if ( propType == "number"   || propType == "numeric" ){	return "28.6" }
		else if ( propType == "array") {return ""; }
    }
	

	// GENERARATE PROPERTY TYPES [GEOMETRY, OBJECT, ARRAY ]
	var generateObject = function(ontology, instance, parent){
		showLog ? console.log('        |--->   generateObject()') : '';

       	instance = "{";
       	if ( ontology.properties ){
	        for ( var obj in ontology.properties ){

				var objtype = ontology.properties[obj].type;
	             // if obj <> date or geometry, iterates recursive for
					// treatment.
	             if ((objtype.toLowerCase() == "object") && (obj != "geometry") && ontology.properties[obj].properties && ontology.properties[obj].properties.$date == null ){
	            	 showLog ? console.log('        |--->   generateObject() --> object: ' + JSON.stringify(ontology.properties[obj])) : '';
	             	instance = instance + "\"" +obj+"\":"+ generateObject(ontology.properties[obj], "", obj);

	             }
				 // date obj
				 else if ((ontology.properties && ontology.properties.$date != null) || (ontology.properties && ontology.properties[obj] && ontology.properties[obj].properties && ontology.properties[obj].properties.$date!= null)){
	                 // date root node or date children node
	            	 if (obj == "$date"){  instance = instance + "\"$date\": \"2014-01-30T17:14:00Z\""; } else { instance = instance + "\"" +obj+"\":"+ "{\"$date\": \"2014-01-30T17:14:00Z\"}"; }
				 }
	             // geometry with direct reference to point
				 else if (ontology[obj] && ontology[obj].properties &&  ontology[obj].properties[propertyName].properties && ontology[obj].properties[propertyName].properties.type && ontology.properties[obj].properties.type.enum[0]== "Point"){
	                 instance = instance + "\"" +obj+"\":"+ "{\"type\":\"Point\", \"coordinates\":[9,19.3]}";

	             }
				 else if (ontology[obj] && ontology[obj].properties &&  ontology[obj].properties[propertyName].properties && ontology[obj].properties[propertyName].properties.type && ontology.properties[obj].properties.type.enum[0]== "LineString"){
	                 instance = instance + "\"" +obj+"\":"+ "{\"type\":\"LineString\", \"coordinates\":[[9,19.3],[19,9.3]]}";

	             }
				 else if (ontology[obj] && ontology[obj].properties &&  ontology[obj].properties[propertyName].properties && ontology[obj].properties[propertyName].properties.type && ontology.properties[obj].properties.type.enum[0]== "Polygon"){
	                 instance = instance + "\"" +obj+"\":"+ "{\"type\":\"Polygon\", \"coordinates\":[ [[9,-19.3],[-19,-9.3],[-9,19.3],[19,-9.3]] ,[[9,19.3],[19,9.3],[-9,19.3],[-19,9.3]] ]}";

	             }
				 else if (ontology[obj] && ontology[obj].properties &&  ontology[obj].properties[propertyName].properties && ontology[obj].properties[propertyName].properties.type && ontology.properties[obj].properties.type.enum[0]== "MultiPoint"){
	                 instance = instance + "\"" +obj+"\":"+ "{\"type\":\"MultiPoint\", \"coordinates\":[[9,19.3],[19,19.3]]}";

	             }
				 else if (ontology[obj] && ontology[obj].properties &&  ontology[obj].properties[propertyName].properties && ontology[obj].properties[propertyName].properties.type && ontology.properties[obj].properties.type.enum[0]== "MultiLineString"){
	                 instance = instance + "\"" +obj+"\":"+ "{\"type\":\"MultiLineString\", \"coordinates\":[ [[9,19.3],[19,9.3]], [[9,19.3],[19,9.3]] ]}";

	             }
				 else if (ontology[obj] && ontology[obj].properties &&  ontology[obj].properties[propertyName].properties && ontology[obj].properties[propertyName].properties.type && ontology.properties[obj].properties.type.enum[0]== "MultiPolygon"){
	                 instance = instance + "\"" +obj+"\":"+ "{\"type\":\"MultiPolygon\", \"coordinates\":[[[[9,2.5],[9,2],[-9,3],[9,-3],[-9,2]]],[[[9,0],[9,-0.5],[9,-1.5],[9,1],[9,0.4]],[[9,0.2],[-9,0.2],[9,0.8],[-9,0.8],[9,3.2]]]]}";

	             }
				// array
				 else if (objtype.toLowerCase() == "array"){
					 showLog ? console.log('        |--->   generateObject() --> array: ' + JSON.stringify(ontology.properties[obj])) : '';
					instance = instance + "\""+ obj + "\":" + generateArray(ontology.properties[obj], "", obj);
	             }
				 else if (obj.format != null){
					 instance = instance +"\"" +obj+"\":\"2014-01-30T17:14:00Z\"}"; 
				 }
				 // Basic
				 else {
	            	 var valor = "";
	            	 // if enum getr first value
	                 if (ontology.properties[obj].enum != null){
	                	  valor = ontology.properties[obj].enum[0];
	                 }
	            	 instance = instance + "\""+ obj + "\":" + generateBasicType(objtype, obj, parent, valor);
	             }
	             instance = instance + ",";
	        }
	        instance = instance.substring(0,instance.length-1);
	     // if obj is null, generate default
       	} else {
       		instance = instance + "\"object\"";
       	}
        return instance + "}";
    }
	
 // GENERARATE PROPERTY TYPES [ ARRAY ]
	var generateArray = function(ontology, instance, parent){
		console.log('        |--->   generateArray()');
        var minItems = 1;
        // Se obtiene el numero minimo de elementos del array
		console.log('ARRAY OBJ: ' + JSON.stringify(ontology));

		if (!ontology.hasOwnProperty('items')){
			instance = instance + "[]";
			return instance;
		}

        if (ontology.minItems != null) {
            minItems =  ontology.minItems;
        }
        instance = instance + "[";


		// main array iteration
		for (var i=0; i <= minItems-1; i++) {
			// object item
			if (ontology.items[i].type.toLowerCase() == "object"){
				instance = instance + generateObject(ontology.items[i], "", parent);
                if (i < minItems -1){
                    instance = instance + ",";
                }
			}
			else{
			// non object item
				var valor = "";
                if (ontology.items[i].enum != null){
                    valor = ontology.items[i].enum;
                }
                if(ontology.items[i].type!="array")
                	instance = instance + generateBasicType(ontology.items[i].type, "", "", valor);
                else
                	instance = instance + generateArray(ontology.items[i], "", "");
                if (i < minItems -1){
                    instance = instance + ",";
                }

			}
		}

        return instance + "]";
	};
    
	// GENERATE DUMMY ONTOLOGY INSTANCE FROM JSON SCHEMA
	var generateOntologyInstance = function(){
		showLog ? console.log('|--->   generateOntologyInstance()') : '';

		var instance 		= "";
		var data 			= "";
		var ontologyJson 	= {};
		hasId = false;
		document.getElementById("ontology_instance").innerHTML = "";

		// check if json-string can be parsed
		if(IsJsonString(editor.getText()) && editor.getText() != "{}"){

			// get JSON
			var ontologyJson = JSON.parse(editor.getText());

			instance = instance + "{"
            // for each property on json.properties
			for ( var property in ontologyJson.properties ){

				data = "";
				// check for root node
				if ( ontologyJson.properties[property] && ontologyJson.properties[property].$ref ){

					if ( !hasId ){	instance = instance + "\"" + property + "\":"; } else {	instance = instance + "\"" + property + "\":";	}

					// access node root reference
					var ref = ontologyJson.properties[property].$ref;
					ref = ref.substring(ref.indexOf("/")+1, ref.length);
					data = ontologyJson[ref].properties;

					// Se genera la seccion correspondiente a cada propiedad del
					// elemento de referencia
					instance = instance + "{ ";
					for( var propertyName in data ) {
						instance = generateProperty(propertyName, data[propertyName], instance);
					}
					instance = instance.substring(0,instance.length-1);
					instance = instance + "}";
				}
				else {
					// if no root node, get from main properties.
					instance = generateProperty(property, ontologyJson.properties[property], instance);
					instance = instance.substring(0,instance.length-1);
				}

				instance = instance + ",";
			}

			instance = instance.substring(0,instance.length-1);
			instance = instance + "}";
			$("#ontology_instance").val("");
			$("#ontology_instance").val(instance);

			if (ontologyJson.properties == null ){
                	document.getElementById("ontology_instance").innerHTML = "";
			}

		}
		else {
			// no JSON no fun!
			$.alert({title: 'JSON SCHEMA!', type: 'red' , theme: 'dark', content: [[#{ontology.valid.noschema}]]});
		}
	}
	
	// CODE MIRROR TEXT AREA
		var handleCodeMirror = function () {			
		myTextArea = document.getElementById('postProcess');
		myCodeMirrorJs = CodeMirror.fromTextArea(myTextArea, {
	    	mode: "text/javascript",
	    	autoRefresh: {delay:0},
	    	autoCloseBrackets: true,
	        matchBrackets: true,
	        styleActiveLine: true,
	        theme:"material",
	        lineWrapping: true,
	        readOnly: 'nocursor'
	
	    });
		myCodeMirrorJs.setSize("100%",200);
	};
	
	
	// MAIN WHEN READY
	var editor;
	$( document ).ready(function() {
		// init when Document is ready
		showLog ? console.log('SHOW ontology ready()...') : '';
		//Splitting rtdb porperties
		var currentDataS = $('#pDatas').text();
		var currentClean = $('#pClean').text();
		$('#pClean').text(currentClean.split(/(?=[A-z])(?=[A-Z])/).join (" "));
		$('#pDatas').text(currentDataS.split(/(?=[A-z])(?=[A-Z])/).join(" "));
		var container = document.getElementById('jsoneditor');	
		var options = {
			mode: 'view',
			theme: 'bootstrap3',			
			modes: ['view','text'], // allowed modes
			error: function (err) {
				$.alert({title: 'ERROR!', theme: 'dark', style: 'red', content: err.toString()});
				return false;
			}
		};
		
		editor = new jsoneditor.JSONEditor(container, options, jsonSchema);
		
		generateOntologyInstance();
		
		//SHOW/HIDE DATATABLE COLUMNS HANDLER
		$('label.toggle-vis').on( 'click', function (e) {
			e.preventDefault(); 
			// Get the column API object
			var column = $('#authorizations').DataTable().column( $(this).attr('data-column') ); 
			// Toggle the visibility
			column.visible( ! column.visible() );			
			// toggle Text
			$(this).toggleClass('text-muted line-through');			
		});	
		
		handleCodeMirror();		
		
	});
	 
	// MAIN WHEN LOAD
	$(window).load(function(){  
		// init on load.		
		showLog ? console.log('SHOW ontology load()...') : '';
		
		// SHOW/HIDE DATATABLES COLUMN INIT 		
		$('.dataTables_filter').append($('#dataTable-vis-toggle'));		
		$('#dataTable-vis-toggle').removeClass('hide');
			
	
	});
	
	//]]>
	</script>	
</body>
</html>