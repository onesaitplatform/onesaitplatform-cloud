<!--

    Copyright Indra Soluciones Tecnologías de la Información, S.L.U.
    2013-2021 SPAIN

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at
         http://www.apache.org/licenses/LICENSE-2.0
    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<html xmlns:th="http://www.thymeleaf.org" xmlns:dt="http://www.thymeleaf.org/dandelion/datatables" th:with="lang=${#locale.language}" th:lang="${lang}">
	<head>
	    <meta name="_csrf" th:content="${_csrf.token}"/>
		<meta name="_csrf_header"  th:content="${_csrf.headerName}"/>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
		<meta http-equiv="Content-Language" th:content="${lang}"/>
		<title th:text="#{name.app}"/>
		
		<!-- STYLE SHEETS -->
		<link rel="stylesheet" type="text/css" media="all" th:href="@{/static/css/bootstrap.min.css}"/>
		<link rel="stylesheet" type="text/css" media="all" th:href="@{/static/css/components.css}"/>
		<link rel="stylesheet" type="text/css" media="all" th:href="@{/static/css/plugins.css}"/>
		<link rel="stylesheet" type="text/css" media="all" th:href="@{/static/css/layout.css}"/>
		<!-- THEME -->
		<link rel="stylesheet" type="text/css" media="all" th:href="@{/static/webjars/sofia2_theme/css/sofia2.css}"/>
		
		<!-- PLUGINS STYLE SHEETS -->
		<link rel="stylesheet" type="text/css" media="all" th:href="@{/static/vendor/datatable/datatables.bootstrap.css}"/>	
	</head>	
	
	<!-- page-sidebar-closed to start page with collapsed menu -->
	<body class="page-header-fixed  page-content-white page-sidebar-closed">

	<!-- MAIN PAGE WRAPPER -->
	<div class="page-wrapper">
	
		<!-- BEGIN HEADER INCLUDE -->
		<div th:include="fragments/header::#headerFragment" class="page-header navbar navbar-fixed-top"></div>
		<!-- END HEADER -->
		
		<!-- BEGIN HEADER AND CONTENT DIVIDER -->
		<div class="clearfix"> </div>		
			
		<!-- BEGIN SIDEBAR -->
		<div th:include="fragments/menu::#menuFragment" class="page-sidebar-wrapper"></div>
		<!-- END SIDEBAR -->
		
				
		<!-- BEGIN CONTENT -->
		<div class="page-content-wrapper">
			
			<!-- BEGIN CONTENT BODY -->
			<div class="page-content">
			
				<!-- SEARCH FORM -->
				<div id="searchFilter"  class="row" >
					<form id="form_dashboard" class="" role="form" method="get">
						<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
						<div class="col-md-3 col-sm-4 col-xs-12">														
							<div class="input-icon">
								<i class="icon-search font-grey-mint"></i>									 														
								<input id="name" th:placeholder="#{gen.name}" name="name" class="form-control" type="text" maxlength="50" value=""/>
							</div>
						</div>
						<div class="col-md-3 col-sm-4 col-xs-12">														
							<div class="input-icon">
								<i class="icon-search font-grey-mint"></i>		
								<select class="form-control" id="type" name="type" >														 
									<option value=""  th:text="#{gen.type}" disabled selected></option>
									<option value="DASHBOARD" th:text="#{dashboards.list.dashboard}"></option>
									<option value="SYNOPTIC" th:text="#{dashboards.list.synoptic}"></option>
								</select>
							</div>
						</div>
						<div class="col-md-6 col-sm-4  col-xs-12">
							<div class="pull-right">
								<button type="button" id="reset_dashboard" name="reset_dashboard" value="Reset" class="btn btn-outline-search" th:text="#{gen.resetBtn}">Reset</button>
								<button type="button" id="search_dashboard" name="search_dashboard" class="btn btn-primary btn-primary-search" th:text="#{gen.search}">Search</button>
							</div>
						</div>									
					</form>
				</div>
				
				<!-- BEGIN PAGE HEADER-->
				
				<!-- BEGIN PAGE BAR AND BREADCRUM -->
				<div class="page-bar margin-bottom-20">
					<ul class="page-breadcrumb">
						<li><span th:text="#{dashboards.my}">My Dashboards</span></li>
					</ul>						
				</div>
				<!-- END PAGE BAR -->
				
				<!-- BEGIN PAGE TITLE-->
				<h1 class="page-title hide "><span th:text="#{dashboards.my}">My Dashboards </span></h1>
				<!-- END PAGE TITLE-->			
				
				<!-- MAIN ROW -->
				<div class="row">				
					<div class="portlet light">
						<div class="portlet-title">
							<div class="caption">									
								<span class="caption-subject" th:text="#{dashboards.my}"> My Dashboard </span>									
							</div>	
							<div class="caption" style="padding: 22px 8px 8px 10px">
								<a onclick="$('.search-icon').toggleClass('hide')" class="search-icon" style="margin-left: 18px;"><i class="icon-search"></i></a>
							</div>
							<div id="search-on-title" class="hide input-icon search-icon">
								<a class ="input-icon" onclick="$('.search-icon').toggleClass('hide')"><i class="icon-search"></i></a>
							</div>								
							<div class="tools hide">
								<a href="" class="collapse" data-original-title="" title=""> </a>
								<a href="" class="fullscreen" data-original-title="" title=""> </a>
							</div>								
							<div class="pull-right btn-title-group">																			
								<button sec:authorize="@securityService.hasAnyRole('ROLE_ADMINISTRATOR') or @securityService.hasAnyRole('ROLE_DEVELOPER') or @securityService.hasAnyRole('ROLE_DATASCIENTIST')" type="button" class="btn btn-outline blue dialog btn-no-border" id="createDashboardButton" onclick="location.href='/controlpanel/gadgets/list'"><span th:text="#{gadgets.listGadgets}">Gadgets</span></button>										
								<button sec:authorize="@securityService.hasAnyRole('ROLE_ADMINISTRATOR') or @securityService.hasAnyRole('ROLE_DEVELOPER') or @securityService.hasAnyRole('ROLE_DATASCIENTIST')" type="button" class="btn btn-outline blue dialog btn-no-border" id="createDashboardButton" onclick="location.href='/controlpanel/datasources/list'"><span th:text="#{datasources.listDatasources}">Datasources </span></button>
								<button sec:authorize="@securityService.hasAnyRole('ROLE_ADMINISTRATOR') or @securityService.hasAnyRole('ROLE_DEVELOPER') or @securityService.hasAnyRole('ROLE_DATASCIENTIST')" type="button" class="btn btn-outline blue dialog btn-no-border" onclick="javascript:showImportDashboardDialog()"><span th:text="#{dashboards.importdashboard}">Import Dashboard</span></button>										
								<button sec:authorize="@securityService.hasAnyRole('ROLE_ADMINISTRATOR') or @securityService.hasAnyRole('ROLE_DEVELOPER') or @securityService.hasAnyRole('ROLE_DATASCIENTIST')" type="button" class="btn btn-outline blue dialog btn-no-border" id="createDashboardButton" onclick="location.href='/controlpanel/dashboards/createsynoptic'"><span th:text="#{dashboards.create.synoptic}">New Synoptic</span></button>
								<div class="pull-right btn-group" id="divcreate" >	
									<button sec:authorize="@securityService.hasAnyRole('ROLE_ADMINISTRATOR') or @securityService.hasAnyRole('ROLE_DEVELOPER') or @securityService.hasAnyRole('ROLE_DATASCIENTIST')" type="button" class="btn btn-primary button-plus-create" id="createDashboardButton" onclick="location.href='/controlpanel/dashboards/create'"><a><i class="icon-new" style="color:white;"></i></a></button>											
								</div>
							</div>
						</div>
						<div class="portlet-body" style="display: block; height: auto;">
							
							<div class="row main">
								<!-- DASHBOARD LIST -->
								<div class="col-md-12">	
																		
									<div id="contenedor-tabla-outside" class="contiene hidden">																						
										<div>	
											<!-- DATATABLE DANDELION CONF. -->												
											<table id="dashboards" class="table table-hover table-striped" dt:table="true" dt:paginationtype="full_numbers">
												<thead>
													<tr class="cabecera-tabla">
														<th class="titulo-columnas" th:text="#{gen.name}">Name</th>
														<th class="titulo-columnas text-center" ><span th:text="#{gen.owner}" >Owner</span></th>
														<th class="titulo-columnas" th:text="#{gen.description}">Description</th>
														<th class="titulo-columnas" th:text="#{gadgets.type}">Type</th>	
														<th class="titulo-columnas text-center" th:text="#{gen.public}">Public</th>															
														<th class="titulo-columnas text-center" ><span th:text="#{gen.created}"> Created At </span></th>
														<th class="titulo-columnas text-center" ><span th:text="#{gen.updated}"> Updated At </span></th>
														<th class="titulo-columnas text-center" ><span > ID </span></th>
														<th class="titulo-columnas text-center" dt:sortable="false" style="width:85px;"><span th:text="#{gen.options}"> Options</span></th>
													</tr>
												</thead>
												<tbody th:remove="all-but-first">
													<tr th:each="dashboard : ${dashboards}" pages:paginate="10">
														<!-- IDENTIFICATION/NAME -->
														<td class="text-left" th:text="${dashboard.identification}"></td>															
														<!-- USER -->
														<td class="text-center " th:text="${dashboard.user.userId}"></td>
														<!-- DESCRIPTION -->
														<td class="text-left text-truncate-sm" th:title="${dashboard.description}" th:text="${dashboard.description}"></td>
														<!-- TYPE -->
														<td class="text-center"  th:if="${dashboard.type != null and dashboard.type.name() == 'SYNOPTIC'}  "><i   th:title="#{dashboards.list.synoptic}" class="fa fa-th-large font-hg font-blue-hoki tooltips"></i></td>
														<td class="text-center"  th:if="${dashboard.type == null or dashboard.type.name() == 'DASHBOARD'}  "><i   th:title="#{dashboards.list.dashboard}" class="fa fa-table font-hg font-blue-hoki tooltips"></i></td>
														
														<!-- PUBLIC -->
														<td class="text-left" th:if="${dashboard.public}"><span th:text="1" style="display:none" ></span><i class="badge badge-empty-success"></i><span th:text="' '+#{gen.public}" style="color: #2E6B33;"></span></span></td>
														<td class="text-left" th:if="${!dashboard.public}"><span th:text="0" style="display:none" ></span><i class="badge badge-empty-error"></i><span th:text="' '+#{gen.private}" style="color: #A73535;"></span></td>
														<!-- DATE --> 
		 												<td class="text-center" th:if="${dashboard.createdAt!=null}"><span th:text="${#dates.format(dashboard.createdAt,'yyyy/MM/dd')}" style="display:none" ></span><span th:text="${#dates.format(dashboard.createdAt,'dd/MM/yyyy')}" ></span></td>
														<td class="text-center" th:if="${dashboard.createdAt==null}" th:text="'---'"></td>
														<!-- UPDATE --> 
		 												<td class="text-center" th:if="${dashboard.updatedAt!=null}"><span th:text="${#dates.format(dashboard.updatedAt,'yyyy/MM/dd')}" style="display:none" ></span><span th:text="${#dates.format(dashboard.updatedAt,'dd/MM/yyyy')}" ></span></td>
														<td class="text-center" th:if="${dashboard.updatedAt==null}" th:text="'---'"></td>
														<td class="text-center " th:text="${dashboard.id}"></td>
														<!-- OPTIONS -->
														<td class="icon" style="white-space: nowrap">
															<div class="grupo-iconos text-center">
																<!-- VIEW -->																																																					
																<a  class="btn btn-xs btn-no-border btn-circle btn-outline blue tooltips" th:title="#{gen.view}" th:href="'/controlpanel/dashboards/view/'+@{${dashboard.id}}"><i class="la la-eye font-hg"></i></a>
																
																<!-- Full EDIT -->																	
																<a  sec:authorize="@securityService.hasAnyRole('ROLE_ADMINISTRATOR') or @securityService.hasAnyRole('ROLE_DEVELOPER') or @securityService.hasAnyRole('ROLE_DATASCIENTIST')" th:if="${dashboard.userAccessType=='EDIT'}" class="btn btn-xs btn-no-border color-blue icon-on-table tooltips" data-placement="bottom" th:title="#{gen.edit}" th:href="'/controlpanel/dashboards/editfull/'+@{${dashboard.id}(form)}+ '='"><i class="icon-edit"></i></a>
																<a  sec:authorize="@securityService.hasAnyRole('ROLE_ADMINISTRATOR') or @securityService.hasAnyRole('ROLE_DEVELOPER') or @securityService.hasAnyRole('ROLE_DATASCIENTIST')" th:if="!${dashboard.userAccessType=='EDIT'}" disabled="true" class="btn btn-xs btn-no-border color-blue icon-on-table tooltips" data-placement="bottom" th:title="#{gen.edit}"><i class="icon-edit"></i></a>
																
																<span class="dropdown">
																	<span   class="btn btn-xs btn-no-border color-blue icon-on-table" data-container="body" data-placement="bottom" data-toggle="dropdown" data-hover="dropdown" data-close-others="true" ><i class="icon-overflow"></i></span>
																		<ul class="dropdown-menu dropdown-menu-table download-menu">
																			<!-- EDIT ACCESS-->
																			<li>
																				<span sec:authorize="@securityService.hasAnyRole('ROLE_ADMINISTRATOR') or @securityService.hasAnyRole('ROLE_DEVELOPER') or @securityService.hasAnyRole('ROLE_DATASCIENTIST')" th:if="${dashboard.userAccessType=='EDIT'}" class="btn btn-xs btn-no-border btn-circle btn-outline" data-container="body" data-placement="bottom" th:attr="onclick='javascript:navigateUrl(\'' + @{|/dashboards/dashboardconf/${dashboard.id}/|} + '\');'"><i class="la la-cog font-hg"></i><span class="span-title-three-dots-icons" th:text="#{dashboards.auth.title}" >Dashboard Conf</span></span>
																			</li>
																			<!-- CLONE-->
																			<li>
																				<span th:title="#{dashboards.clone}" class="btn btn-xs btn-no-border btn-circle btn-outline" th:attr="onclick='javascript:cloneDashboardDialog(\''+${dashboard.id}+ '\',\'' +${dashboard.identification}+'\');'"><i class="la la-clone font-hg"></i><span class="span-title-three-dots-icons" th:text="#{dashboards.clone}" >Clone</span></span>
																			</li>
																			<!-- URL -->
																			<li>
																				<span  class="btn btn-xs btn-no-border btn-circle btn-outline" data-container="body" data-placement="bottom" th:attr="onclick='javascript:showDashboardURLDialog(\'' + @{|/dashboards/view/${dashboard.id}} + '\');'"><i class="la la-link font-hg"></i><span class="span-title-three-dots-icons">URL Dashboard</span></span>
																		    </li>
																		    <!-- DOWNLOAD -->
																		    <li>																   
																		    	<span th:title="#{dashboards.download}" class="btn btn-xs btn-no-border btn-circle btn-outline" th:alt="#{dashboards.download}" th:if="${dashboard.userAccessType=='EDIT'}"  th:attr="onclick='javascript:navigateUrl(\'' + @{|/dashboards/exportDashboard/${dashboard.id}/|} + '\');'"><i class="la la-download font-hg"></i><span class="span-title-three-dots-icons" th:text="#{dashboards.download}" >Download</span></span>
																		    </li>
																			<!-- IMPORT -->
																			<li>
																				<span sec:authorize="@securityService.hasAnyRole('ROLE_ADMINISTRATOR') or @securityService.hasAnyRole('ROLE_DEVELOPER') or @securityService.hasAnyRole('ROLE_DATASCIENTIST')" th:if="${dashboard.userAccessType=='EDIT'}"  class="btn btn-xs btn-no-border btn-circle btn-outline" data-container="body" data-placement="bottom" th:attr="onclick='javascript:showImportDashboardTableDialog(\'' + ${dashboard.identification} + '\');'"><i class="la la-upload font-hg"></i><span class="span-title-three-dots-icons" th:text="#{dashboards.import}" >Import</span></span>
																		    </li>																		    
																		    <!-- EDIT DASHBOARD JSON-->
																		    <li>
																				<span sec:authorize="@securityService.hasAnyRole('ROLE_ADMINISTRATOR')"  class="btn btn-xs btn-no-border btn-circle btn-outline " data-container="body" data-placement="bottom" th:attr="onclick='javascript:navigateUrl(\'' + @{|/dashboards/edit/${dashboard.id}/|} + '\');'"><i class="la la-edit font-hg"></i><span class="span-title-three-dots-icons" th:text="#{dashboards.edit.model.json.tooltip}" >Edit Json</span></span>																	
																			</li>
																		    <!-- DELETE -->
																		    <li>
																		    	<span sec:authorize="@securityService.hasAnyRole('ROLE_ADMINISTRATOR') or @securityService.hasAnyRole('ROLE_DEVELOPER') or @securityService.hasAnyRole('ROLE_DATASCIENTIST')" th:if="${dashboard.userAccessType=='EDIT'}" class="btn btn-xs btn-no-border btn-circle btn-outline color-red" data-container="body" data-placement="bottom" th:attr="onclick='deleteDashboardConfirmation(\''+${dashboard.id}+'\');'"><i class="icon-delete"></i><span class="span-title-three-dots-icons" th:text="#{gen.deleteBtn}" >Delete</span></span>
																	    	</li>
																	    </ul>
																    </span>
															    </span>
															</div>
														</td>
													</tr>
												</tbody>
											</table>	
											<!-- TABLE COLUMNS CONTAINER SHOW/HIDE -->
											<div id="dataTable-vis-toggle" class="btn-group margin-right-10 hide">
												<a  class="dropdown-togglebtn btn-primary button-dropdown-table-columns"  data-toggle="dropdown" aria-expanded="false"  > <i class="icon-show-columns" ></i></a>
												<div id="column_toggler" data-container="body" class="dropdown-menu hold-on-click pull-right">
													<span class="checkbox-column">
														<input class="toggle-vis" type="checkbox" data-column="0" checked/>
														<label th:text="#{gen.name}"> Name </label>
													</span>
													<span class="checkbox-column">
														<input class="toggle-vis" type="checkbox" data-column="1" checked/>
														<label th:text="#{gen.owner}"> Owner </label>
													</span>
													<span class="checkbox-column">
														<input class="toggle-vis" type="checkbox" data-column="2" checked/>
														<label th:text="#{gen.description}"> Description </label>
													</span>
													<span class="checkbox-column">
														<input class="toggle-vis" type="checkbox" data-column="3" checked/>
														<label th:text="#{gen.type}"> Type</label>
													</span>
													<span class="checkbox-column">
														<input class="toggle-vis" type="checkbox" data-column="4" checked/>
														<label th:text="#{gen.public}"> Public </label>
													</span>
													<span class="checkbox-column">
														<input class="toggle-vis" type="checkbox" data-column="5" checked/>
														<label th:text="#{gen.created}"> Created at</label>
													</span>
													<span class="checkbox-column">
														<input class="toggle-vis" type="checkbox" data-column="6" checked/>
														<label th:text="#{gen.updated}"> Updatet at</label>
													</span>
													<span class="checkbox-column">
														<input class="toggle-vis" type="checkbox" data-column="7" checked/>
														<label > ID</label>
													</span>
													<span class="checkbox-column">
														<input class="toggle-vis" type="checkbox" data-column="8" checked/>
														<label th:text="#{gen.options}"> Options</label>
													</span>						
												</div>
											</div>
																			
										</div>
									</div>											
								</div>
							</div>
							<!-- AUXILIAR FORM TO DELETE DATASOURCE -->
							<form id="delete_dashboard_form" class="delete-dashboard hide" method="post">
								<input type="hidden" name="_method" value="DELETE"/>
								<input type="hidden" id="delete-id" name="id"/>
								<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
							</form>	
						</div>
					</div><!-- END PORTLET BASIC LIGHT -->							
				</div><!-- END MAIN ROW -->				
			</div><!-- END CONTENT BODY -->
		</div><!-- END CONTENT page-content-wrapper -->		
	</div>
	<!-- END MAIN PAGE WRAPPER -->
	
	<!-- FOOTER-INCLUDE -->
	<footer th:include="fragments/footer::#footerFragment" class="page-footer"> </footer>	
	
	<!-- CORE CONTROLLERS -->
	<script th:src="@{/static/js/app.js}"></script>
	<script th:src="@{/static/js/layout.js}"></script>
	
	<!-- PLUGINS -->
	<script th:src="@{/static/vendor/jquery/jquery.dataTables.min.js}"></script>
	<script th:src="@{/static/vendor/datatable/datatables.bootstrap.js}"></script>	
	<script th:src="@{/static/vendor/jquery/jquery.autocomplete.js}"></script>
	
	<!-- INPUTMASK -->
	<script th:src="@{/static/vendor/jquery-inputmask/dist/min/jquery.inputmask.bundle.min.js}"></script>
	
	<script type="text/javascript" th:inline="javascript">	
	
	// TEMPLATE SEARCH FORM.
	var sname = [[${param.name}]] || '';
	var stype = [[${param.type}]] || '';
	var cloneTitle = [[#{dashboards.cloneText}]];
	var Cancel = [[#{gen.cancelBtn}]];
	var Close = [[#{gen.closeBtn}]];
	var Confirm = [[#{gen.confirmBtn}]];
	var Copy = [[#{gen.copyBtn}]];
	var CloneFail = [[#{dashboards.cloneFail}]];
	var MinLen = [[#{dashboards.minLen}]];
	
	sname ? $('#name').val(sname) : sname = '';
	stype ? $('#type').val(stype) : stype = '';
	console.log('SEARCHING ... [ Name: ' + sname + ' Type: ' + stype + ']');
	if (( sname != '') || (stype != '')) { $('#search-toggle').trigger('click'); }
	
	// DATATABLES LANGUAJE FROM PROPERTIES.
	datatable_lang = [[#{datatables_lang}]];	
	var languageJson = JSON.parse(datatable_lang);
	if ( languageJson ){ $.extend( true, $.fn.dataTable.defaults, { language: languageJson }); }

	</script>
	
	<script type="text/javascript"  th:inline="javascript">	
	//<![CDATA[
	var optionName = 'DASHBOARDS';
	
	var cloneDashboardDialog = function(dashboardId, identification){
		$.confirm({
			title: cloneTitle,
			theme: 'light',
			columnClass: 'medium',
			content: "<input class='col-md-12 form-control' type=text id='cloneIdentification' placeholder='"+MinLen+"'"+"></input>",
			draggable: true,
			dragWindowGap: 100,
			backgroundDismiss: true,
			buttons: {
				close: {
					text: Cancel,
					btnClass: 'btn btn-outline blue dialog',
					action: function (){} //GENERIC CLOSE.		
				},
				Ok: {
					text: Confirm,
					btnClass: 'btn btn-primary',
					action: function(){ 
						if($("#cloneIdentification").val()=="" || !$("#cloneIdentification").val() ||
							$("#cloneIdentification").val().length < 5){
			                cloneFail();
						}
						else {$.post(
								"/controlpanel/dashboards/clone", 
								{dashboardId : dashboardId, identification : $("#cloneIdentification").val()}
							).success(function(){
								navigateUrl("/controlpanel/dashboards/list")
								}
							).fail(
								function(e){									
									console.log("Error cloning dashboard, message detail: " + e.responseText);
									cloneFail();
								}
							)}
					}											
				}					
			}
		});
	}	
	
	var cloneFail = function (){
		$.alert({
			title : "Error",
			theme : 'light',
			content : CloneFail,
			buttons: {
				Ok: {
					text: Close,
					btnClass: 'btn btn-primary',
					action: function (){}		
					}
				},
			})
	}
	
	var showDashboardURLDialog = function(url){
		
		var tenant =[[${tenant}]];
		var vertical = [[${vertical}]];
		
		if(vertical != null){
			url = url + '?vertical='+vertical+'&tenant='+tenant;
		}
		var editUrl = url.replace("/view/", "/editfull/");
		var viewIframUrl = url.replace("/view/", "/viewiframe/");
		var editIframUrl = url.replace("/view/", "/editfulliframe/");
		
		var messageInfo = [[#{dashboards.url.info}]]
		var messageCopied = [[#{dashboards.url.copied}]];
		
		var messageView = [[#{dashboards.url.view}]];
		var messageEdit = [[#{dashboards.url.edit}]];
		var messageViewIframe = [[#{dashboards.url.view.embedded}]];
		var messageEditIframe = [[#{dashboards.url.edit.embedded}]];
		
		$.confirm({
			title: "URL Dashboard",
			theme: 'light',
			columnClass: 'medium',
			content:`	
				<div class="alert alert-info alert-dismissable">
						<button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
						<i class="fa fa-info-circle"></i> 
							<span>${messageInfo}</span>			
						</div>
						<div id="infoCopied" class="alert alert-success display-hide">
							<button class="close" data-close="alert"></button> <span >${messageCopied}</span>
						</div>
						<div><label>${messageView}</label>
						<input class="col-md-12 form-control" readonly="readonly" value="${window.location.origin}${url}" onclick=" this.select();document.execCommand('copy'); $('#infoCopied').show();" type="text"/>						
						</div>
						<div><label>${messageEdit}</label>
						<input class="col-md-12 form-control" readonly="readonly" value="${window.location.origin}${editUrl}" onclick=" this.select();document.execCommand('copy'); $('#infoCopied').show();" type="text"/>						
						</div>
						<div><label>${messageViewIframe}</label>
						<input class="col-md-12 form-control" readonly="readonly" value="${window.location.origin}${viewIframUrl}" onclick=" this.select();document.execCommand('copy'); $('#infoCopied').show();" type="text"/>						
						</div>
						<div><label>${messageEditIframe}</label>
						<input class="col-md-12 form-control" readonly="readonly" value="${window.location.origin}${editIframUrl}" onclick=" this.select();document.execCommand('copy'); $('#infoCopied').show();" type="text"/>						
						</div>
						`,
			draggable: true,
			dragWindowGap: 100,
			backgroundDismiss: true,
			buttons: {
				Ok: {
					text: Cancel,
					btnClass: 'btn btn-outline blue dialog',
					action: function(){ 
					}											
				},
				Copy: {
					text: Copy,
					btnClass: 'btn btn-primary',
					action: function(){ 
						copyURL(window.location.origin + url);
					}	
				}
			}
		});
	};
	
var showExportImageDialog = function(id){

	
		var messageExportImage = [[#{dashboards.export.image}]];
		var messageStandbyTime = [[#{dashboards.export.wait}]];
		var messageheight= [[#{dashboards.export.height}]];
		var messagewidth= [[#{dashboards.export.width}]];
		var messagefullpage= [[#{dashboards.export.fullpage}]];
		var messagepresetsize= [[#{dashboards.export.presetsize}]];
		var messageparams= [[#{dashboards.export.params}]];
		var globalMessage=[[#{dashboards.export.emptyfields}]];
		
		$.confirm({
			icon: 'la la-file-image-o font-hg',
			title: messageExportImage,
			theme: 'light',
			columnClass: 'medium',
			content:`	
				<div class="form-body container-fluid">
				<div id="imagehaserror" class="alert alert-danger display-hide">
				<span >${globalMessage}</span>
			    </div>
					<div class="row">
						<div class="col-md-6 col-sm-6 col-xs-12">
						<div class="form-group">
							<label >${messageStandbyTime}</label><span class="required"> (*)</span>
							<div class="input-icon ">
								<input
									id="imagewaittime" type="number" 
									required="true" maxlength="100"
									 class="form-control "  minlength="1" required value="20000" />
						     </div>
					    </div>
				        </div>	
				        <div class="col-md-5 col-sm-6 col-xs-12">
						<div class="form-group">							
						<div class="mt-checkbox-list"> 
							<label class="mt-checkbox popovers font-sm" data-trigger="hover" data-placement="top" data-container="body" ><i class="la la-lightbulb-o font-md"></i> <div class="inline font-xs" >${messagefullpage}?</div>
								<input  id="checkboxfullscreen" class="form-control no-remove"  name="checkboxfullscreen" type="checkbox"    />
								<span></span>
							</label>
						</div>
					    </div>
				      </div>
				        
					 </div>
					 <div class="row">
					 <div class="col-md-4 col-sm-6 col-xs-12">
						<div class="form-group">
							<label >${messagepresetsize}</label>
							  <select id="imageselectsize" class="form-control"  data-live-search="true" data-width="100%"  onchange="updateheightwidthimage()"  >
							   <option   value="A0 H" >A0 H</option>
							   <option   value="A0 V" >A0 V</option> 
							   <option   value="A1 H" >A1 H</option>
							   <option   value="A1 V" >A1 V</option> 
							   <option   value="A2 H" >A2 H</option>
							   <option   value="A2 V" >A2 V</option>
							   <option   value="A3 H" >A3 H</option>
							   <option   value="A3 V" >A3 V</option>
							   <option selected  value="A4 H" >A4 H</option>
							   <option   value="A4 V" >A4 V</option>
							   <option   value="A5 H" >A5 H</option>
							   <option   value="A5 V" >A5 V</option>
							   <option   value="A6 H" >A6 H</option>
							   <option   value="A6 V" >A6 V</option>							   
						      </select>
					    </div>
				        </div>		
						<div class="col-md-4 col-sm-6 col-xs-12">
						<div class="form-group">
							<label >${messageheight}</label><span class="required"> (*)</span>
							<div class="input-icon ">
								<input
									id="imageheight" type="number" 
									required="true" 
									 class="form-control "  minlength="1" required value="794" />
						     </div>
					    </div>
				        </div>	
				        <div class="col-md-4 col-sm-6 col-xs-12">
						<div class="form-group">
							<label >${messagewidth}</label><span class="required"> (*)</span>
							<div class="input-icon ">
								<input
									id="imagewidth" type="number" 
									required="true" 
									 class="form-control "  minlength="1" required value="1123" />
						     </div>
					    </div>
				        </div>
				        
				        
				        
					 </div>
					 <div class="row">
						 <div class="col-md-12 col-sm-12 col-xs-12">
							<div class="form-group">
								<label>${messageparams}</label>														
								<textarea id="imageparams"   class="form-control" rows="2" data-min-rows='2'></textarea>
							</div>							
						</div>
					</div> 
				</div>
				
						`,
			draggable: true,
			dragWindowGap: 100,
			backgroundDismiss: true,
			buttons: {
				close: {
					text: Cancel,
					btnClass: 'btn btn-outline blue dialog',
					action: function(){ 
					}											
				},				
				Send: {
					text: Confirm,
					btnClass: 'btn btn-primary',
					action: function(){						
						var token = $('#oauthToken').html().substring(7,$('#oauthToken').html().length);						
						var imageparams = $('#imageparams').val();
						var imagewidth = $('#imagewidth').val();
						var imageheight = $('#imageheight').val();
						var checkboxfullscreen = $('#checkboxfullscreen').prop('checked');
						var imagewaittime = $('#imagewaittime').val();
						var ident = id;
						var csrf_value = $("meta[name='_csrf']").attr("content");
						var csrf_header = $("meta[name='_csrf_header']").attr("content"); 					
							
						var data ={};
						if(typeof imageparams ==='undefined' || imageparams.trim().length===0){
							data = {
						    	waittime:imagewaittime,
						    	height:imageheight,
						    	width:imagewidth,
						    	fullpage:checkboxfullscreen	,
						    	token:token
						    }
						}else{
							data = {
							    	waittime:imagewaittime,
							    	height:imageheight,
							    	width:imagewidth,
							    	fullpage:checkboxfullscreen,
							    	params:imageparams,
							    	token:token
							    }
						}
						var ok = typeof imagewidth!=='undefined' && imagewidth!==null  && imagewidth.trim().length>0
						&& typeof imageheight!=='undefined' && imageheight!==null  && imageheight.trim().length>0
						&& typeof imagewaittime!=='undefined' && imagewaittime!==null  && imagewaittime.trim().length>0 ;	
						if(ok){
					    	var downloadUrl ='/controlpanel/dashboards/generateDashboardImage/'+id+'?'+ encodeQueryData(data);							    
					    	var download = document.createElement('a');
					    	download.href =   downloadUrl;					    	
					    	download.click();							    	
					    	return true;						
						}else{
							$('#imagehaserror').show();
							return false;
						}
					}											
				}
			}
		});
	};
	
	function encodeQueryData(data) {
		   const ret = [];
		   for (let d in data)
		     ret.push(encodeURIComponent(d) + '=' + encodeURIComponent(data[d]));
		   return ret.join('&');
		}
	
	
	var showExportPDFDialog = function(id){
		
		var messageExportPDF = [[#{dashboards.export.pdf}]];
		var messageStandbyTime = [[#{dashboards.export.wait}]];
		var messageheight= [[#{dashboards.export.height}]];
		var messagewidth= [[#{dashboards.export.width}]];		
		var messagepresetsize= [[#{dashboards.export.presetsize}]];
		var messageparams= [[#{dashboards.export.params}]];
		var globalMessage=[[#{dashboards.export.emptyfields}]];
		
		$.confirm({
			icon: 'la la-file-pdf-o font-hg',
			title: messageExportPDF,
			theme: 'light',
			columnClass: 'medium',
			content:`	
				<div class="form-body container-fluid">	
				<div id="imagehaserror" class="alert alert-danger display-hide">
				<span >${globalMessage}</span>
			    </div>
					<div class="row">
						<div class="col-md-6 col-sm-6 col-xs-12">
						<div class="form-group">
							<label >${messageStandbyTime}</label><span class="required"> (*)</span>
							<div class="input-icon ">
								<input
									id="pdfwaittime" type="number" 
									required="true" maxlength="100"
									 class="form-control "  minlength="1" required value="20000" />
						     </div>
					    </div>
				        </div>	
				        
					 </div>
					 <div class="row">
					 <div class="col-md-4 col-sm-6 col-xs-12">
						<div class="form-group">
							<label >${messagepresetsize}</label>
							  <select id="pdfselectsize" class="form-control"  data-live-search="true" data-width="100%"  onchange="updateheightwidthpdf()">
							   <option   value="A0 H" >A0 H</option>
							   <option   value="A0 V" >A0 V</option> 
							   <option   value="A1 H" >A1 H</option>
							   <option   value="A1 V" >A1 V</option> 
							   <option   value="A2 H" >A2 H</option>
							   <option   value="A2 V" >A2 V</option>
							   <option   value="A3 H" >A3 H</option>
							   <option   value="A3 V" >A3 V</option>
							   <option selected  value="A4 H" >A4 H</option>
							   <option   value="A4 V" >A4 V</option>
							   <option   value="A5 H" >A5 H</option>
							   <option   value="A5 V" >A5 V</option>
							   <option   value="A6 H" >A6 H</option>
							   <option   value="A6 V" >A6 V</option>							   
						      </select>
					    </div>
				        </div>		
						<div class="col-md-4 col-sm-6 col-xs-12">
						<div class="form-group">
							<label >${messageheight}</label><span class="required"> (*)</span>
							<div class="input-icon ">
								<input
									id="pdfheight" type="number" 
									required="true" 
									 class="form-control "  minlength="1" required value="794" />
						     </div>
					    </div>
				        </div>	
				        <div class="col-md-4 col-sm-6 col-xs-12">
						<div class="form-group">
							<label >${messagewidth}</label><span class="required"> (*)</span>
							<div class="input-icon ">
								<input
									id="pdfwidth" type="number" 
									required="true" 
									 class="form-control "  minlength="1" required value="1123" />
						     </div>
					    </div>
				        </div>
				        
				        
				        
					 </div>
					 <div class="row">
						 <div class="col-md-12 col-sm-12 col-xs-12">
							<div class="form-group">
								<label>${messageparams}</label>														
								<textarea id="pdfparams"   class="form-control" rows="2" data-min-rows='2'></textarea>
							</div>							
						</div>
					</div> 
				</div>
						`,
			draggable: true,
			dragWindowGap: 100,
			backgroundDismiss: true,
			buttons: {
				close: {
					text: Cancel,
					btnClass: 'btn btn-outline blue dialog',
					action: function(){ 
					}											
				},			
				Ok: {
					text: Confirm,
					btnClass: 'btn btn-primary',
					action: function(){ 						
						var token = $('#oauthToken').html().substring(7,$('#oauthToken').html().length);;						
						var pdfparams = $('#pdfparams').val();
						var pdfwidth = $('#pdfwidth').val();
						var pdfheight = $('#pdfheight').val();
						var checkboxfullscreen = $('#checkboxfullscreen').val();
						var pdfwaittime = $('#pdfwaittime').val();
						var ident = id;
						var csrf_value = $("meta[name='_csrf']").attr("content");
						var csrf_header = $("meta[name='_csrf_header']").attr("content"); 					
						var ok = true;	
						
						var data ={};
						if(typeof pdfparams ==='undefined' || pdfparams.trim().length===0){
							data = {
									waittime:pdfwaittime,
							    	height:pdfheight,
							    	width:pdfwidth,
							    	fullpage:checkboxfullscreen,
							    	token:token			    	
						    }
						}else{
							data = {
									waittime:pdfwaittime,
							    	height:pdfheight,
							    	width:pdfwidth,
							    	fullpage:checkboxfullscreen,
							    	token:token,
							    	params:pdfparams
							    }
						}
						var ok = typeof pdfwidth!=='undefined' && pdfwidth!==null  && pdfwidth.trim().length>0
							&& typeof pdfheight!=='undefined' && pdfheight!==null  && pdfheight.trim().length>0
							&& typeof pdfwaittime!=='undefined' && pdfwaittime!==null  && pdfwaittime.trim().length>0 ;	
						if(ok){
							var downloadUrl ='/controlpanel/dashboards/generatePDFImage/'+id+'?'+ encodeQueryData(data);							    
					    	var download = document.createElement('a');
					    	download.href = downloadUrl;					    	
					    	download.click();							    	
					    	return true;
						} else{
							$('#imagehaserror').show();
							return false;
						}
						}
					}											
				
			}
		});
	};
	
	
	function updateheightwidthimage(){
		var selected = $('#imageselectsize').val();
		var dimensions = getDimensions(selected);
		$('#imageheight').val(dimensions.height);
		$('#imagewidth').val(dimensions.width);
	}

	function updateheightwidthpdf(){
		var selected = $('#pdfselectsize').val();
		var dimensions = getDimensions(selected);
		$('#pdfheight').val(dimensions.height);
		$('#pdfwidth').val(dimensions.width);
	}
	
	
	function getDimensions(selected){
		//A4 H 96PPI/DPI
		var height=794;
		var width=1123;
		if(selected==="A0 V"){
			height=4494;
	    	width=3179;			
		}else if(selected==="A0 H"){
			 height=3179;
			 width=4494;			
		}else if(selected==="A1 V"){
			height=3179;
	    	width=2245 ;			
		}else if(selected==="A1 H"){
			 height=2245;
			 width=3179;			
		}else if(selected==="A2 V"){
			height=2245;
	    	width=1587;			
		}else if(selected==="A2 H"){
			 height=1587;
			 width=2245;			
		}else if(selected==="A3 V"){
			height=1587;
	    	width=1123;			
		}else if(selected==="A3 H"){
			 height=1123;
			 width=1587;			
		}else if(selected==="A4 V"){
			height=1123;
		    width=794;			
		}else if(selected==="A4 H"){
			 height=794;
			 width=1123;			
		}else if(selected==="A5 V"){
			height=794;
	    	width=559;			
		}else if(selected==="A5 H"){
			 height=559 ;
			 width=794;			
		}else if(selected==="A6 V"){
			height=559;
	    	width=397;			
		}else if(selected==="A6 H"){
			 height=397 ;
			 width=559;			
		}		
		return {'height':height,'width':width};
	}
	
	function navigateUrl(url){  window.location.href = url;	}
	function navigateNewTab(url){ window.open(url, '_blank');  	}
	
	var  deleteDashboardConfirmation = function (id){
	
		showConfirmDeleteDialog(id);	
	} 
	
	var deleteUrl =  [[@{/dashboards}]];
	var showConfirmDeleteDialog = function(id){	
		$('#delete_dashboard_form').attr('action', deleteUrl + '/' + id);
		$('#delete-id').val(id);
		HeaderController.showConfirmDialogDashboard('delete_dashboard_form');	
	}
	
	var copyURL = function(url){
			var $temp = $("<input />");
			$("body").append($temp);
			$temp.val(url).select();
			document.execCommand("copy");
			$temp.remove();
			
	}		

	// MAIN WHEN READY
	$( document ).ready(function() {
	
		//SHOW/HIDE DATATABLE COLUMNS HANDLER
		$('input.toggle-vis').on( 'change', function (e) {
			e.preventDefault(); 
			// Get the column API object
			var column = $('#dashboards').DataTable().column( $(this).attr('data-column') ); 
			// Toggle the visibility
			column.visible( ! column.visible() );			
			// toggle Text
			//$(this).toggleClass('text-muted line-through');			
		});	
		
		// SEARCH FORM RESET
		$('#reset_dashboard').on('click',function(){
			$('#form_dashboard')[0].reset();
			$('#form_dashboard')[0].submit();
		});
		
		var createDashboard = function(name){
			$.post(
				"/controlpanel/dashboards/create", 
				{identification : name}
			).done(function(id){
				navigateUrl("/controlpanel/dashboards/editfull/" + id)}
			).fail(
				function(e){
					console.log("Error creating dashboard, message detail: " + e.responseText);
				}
			)
		}
		
		var createDashboardDialog = function(){
			$.confirm({
				title: "Insert the new dashboard name",
				theme: 'light',
				columnClass: 'medium',
				content: "<input class='col-md-12 form-control' type=text id='newDashboard'></input>",
				draggable: true,
				dragWindowGap: 100,
				backgroundDismiss: true,
				buttons: {
					close: {
						text: Cancel,
						btnClass: 'btn btn-outline blue dialog',
						action: function (){} //GENERIC CLOSE.		
					},
					Ok: {
						text: Confirm,
						btnClass: 'btn btn-primary',
						action: function(){ 
							if($("#newDashboard").val()=="" || !$("#newDashboard").val()){
				                console.log("dashboard empty");
				                return;
				            }
				            createDashboard($("#newDashboard").val());
				            $( this ).dialog( "close" );
						}											
					}					
				}
			});
		}		
		
		
		/*$("#createDashboardButton").on("click", createDashboardDialog);*/
		// SEARCH FORM
		$('#search_dashboard').on('click',function(){ $('#form_dashboard')[0].submit(); });
		
	});
	 
	// MAIN WHEN LOAD
	$(window).load(function(){  
		
		var oTable = $('#dashboards').dataTable({
		      "bAutoWidth": false
		      });
		
		// HIDE COLUMNS (DeESCRIPTION,  CREATEDAT)		
		$.each([1,3,7],function(ind,value){ $("input.toggle-vis[data-column='"+ value +"']").trigger('click'); });
		
		// SHOW/HIDE DATATABLES COLUMN INIT 		
		$('.dataTables_filter').append($('#dataTable-vis-toggle'));	
		$('#dataTable-vis-toggle').removeClass('hide');

		//TABLE STYLES
		$('#divcreate').prepend($('#dataTable-vis-toggle'));
		$('.dataTables_info').addClass('col-md-6 col-sm-6');
		$('.dataTables_length').addClass('col-md-6 col-sm-6');
		
		$('#search-on-title').append($('.dataTables_filter > label > input'));
		$('#search-on-title > input').removeClass('input-xsmall');
		
		$('#dashboards_wrapper > div:nth-child(3)').addClass('table-scrollable table-scrollable-borderless');
		$('#dashboards_wrapper > div:nth-child(3) > div.col-md-5.col-sm-5').append($('.dataTables_length'));
		$('#dashboards_wrapper > div:nth-child(1)').hide();
		
		$('.dataTables_paginate').attr('style', 'float:right !important');
		$('.download-menu').parent().on('shown.bs.dropdown', function () {	        
			 var $menu = $("ul", this);	        
	         offset = $menu.offset();
	         position = $menu.position();
	         $('body').append($menu);
	         $menu.show();
	         $menu.css('position', 'absolute');
	         $menu.css('top', (offset.top) +'px');
	         $menu.css('left',(offset.left) +'px');
	         $menu.css('min-width', '100px');
	        $(this).data("myDropdownMenu", $menu);
	     });
	     $('.download-menu').parent().on('hide.bs.dropdown', function () {
	         $(this).append($(this).data("myDropdownMenu"));
	         $(this).data("myDropdownMenu").removeAttr('style');
	     });
		
		
		$("#contenedor-tabla-outside").removeClass("hidden");
	});	
	
	
	
	var showImportDashboardDialog = function(){
		var textCreated =  [[#{dashboards.ontologies.must.be.created}]];
		var textOverwrite = [[#{dashboards.overwrite}]];
		var textimportAuth = [[#{dashboards.importAuthorizations}]];
		$.confirm({
			title: [[#{dashboards.importdashboard}]],
			theme: 'light',
			columnClass: 'medium',
			content: "<div class='alert alert-info' role='alert'><i class='fa fa-info-circle'></i><span >&nbsp" + textCreated + " </span> </div><input class='element text form-control' type='text' id='newImportDashboard' placeholder=''/><br/><label id='patternAlert' class='hidden col-md-12 alert alert-warning'>Pattern [a-zA-Z0-9_ ]+</label><br/><input type='hidden' id='dataJSONImport' /><input class='element text form-control' type='file' accept='.json' id='jsonInputData' onchange='fileImportChange(this.files[0])' /><div class='form-group'><div class='mt-checkbox-list'> <label class='mt-checkbox font-md popovers' data-trigger='hover' data-placement='top' data-container='body' ><i class='la la-lightbulb-o'></i> <div class='inline font-xs' >"+textOverwrite+"</div>        <input id='overwritecheck' name='overwritecheck' type='checkbox' class='no-remove' checked='checked'/>        <span></span><!-- needed by styles -->    </label>     <label class='mt-checkbox font-md popovers' data-trigger='hover' data-placement='top' data-container='body' ><i class='la la-lightbulb-o'></i> <div class='inline font-xs'>"+textimportAuth+"</div>        <input id='importAuthcheck' name='importAuthcheck' type='checkbox' class='no-remove'  checked='checked'/>        <span></span><!-- needed by styles -->    </label></div></div>",
			draggable: true,
			dragWindowGap: 100,
			backgroundDismiss: true,
			onContentReady: function () {
				// INPUT MASK FOR identification allow only letters, numbers and -_
					$("#newImportDashboard").inputmask({ regex: "[a-zA-Z 0-9_-]*", greedy: false });
				},
			buttons: {
				close: {
					text: Cancel,
					btnClass: 'btn btn-outline blue dialog',
					action: function (){} //GENERIC CLOSE.		
				},
				Ok: {
					text: Confirm,
					btnClass: 'btn btn-primary',
					action: function() {
						
						if($("#newImportDashboard").val()=="" || !$("#jsonInputData").val() || $("#jsonInputData").val()=="" || !$("#newImportDashboard").val()){
							console.log("dashboard name or json file empty");
							return;
						}
						var dashboardName = $("#newImportDashboard").val().trim();
						var dashboardExtension = $("#jsonInputData").val().split('.').pop();
						if(/^[a-zA-Z0-9_ ]+$/.test(dashboardName)){
							importDashboard(dashboardName,$("#dataJSONImport").val(), dashboardExtension,$("#overwritecheck").is(":checked"),$("#importAuthcheck").is(":checked"));
						}
						else{
							$("#patternAlert").removeClass("hidden");
							return false;
						}
					}									
				}
			}
		});
	}

	var showImportDashboardTableDialog = function(identifier){
		
		var textCreated =  [[#{dashboards.ontologies.must.be.created}]];
		var textOverwrite = [[#{dashboards.overwrite}]];
		var textimportAuth = [[#{dashboards.importAuthorizations}]];
		$.confirm({
			title: [[#{dashboards.importdashboard}]],
			theme: 'light',
			columnClass: 'medium',
			content: "<div class='alert alert-info' role='alert'><i class='fa fa-info-circle'></i><span >&nbsp" + textCreated + " </span> </div><input type='hidden' id='dataJSONImport' /><input class='element text form-control' type='file' accept='.json' id='jsonInputData' onchange='fileImportChange(this.files[0])' /><div class='form-group'><div class='mt-checkbox-list'> <label class='mt-checkbox font-md popovers' data-trigger='hover' data-placement='top' data-container='body' ><i class='la la-lightbulb-o'></i> <div class='inline font-xs' >"+textOverwrite+"</div>        <input id='overwritecheck' name='overwritecheck' type='checkbox' class='no-remove' checked='checked'/>        <span></span><!-- needed by styles -->    </label>     <label class='mt-checkbox font-md popovers' data-trigger='hover' data-placement='top' data-container='body' ><i class='la la-lightbulb-o'></i> <div class='inline font-xs'>"+textimportAuth+"</div>        <input id='importAuthcheck' name='importAuthcheck' type='checkbox' class='no-remove'  checked='checked'/>        <span></span><!-- needed by styles -->    </label></div></div>",
			draggable: true,
			dragWindowGap: 100,
			backgroundDismiss: true,
			buttons: {
				close: {
					text: Cancel,
					btnClass: 'btn btn-outline blue dialog',
					action: function (){} //GENERIC CLOSE.		
				},
				Ok: {
					text: Confirm,
					btnClass: 'btn btn-primary',
					action: function() {
						if(identifier =="" || !$("#jsonInputData").val() || $("#jsonInputData").val()=="" || ! identifier){
							console.log("json file empty");
							return;
						}
						
						var dashboardExtension = $("#jsonInputData").val().split('.').pop();
						importDashboard(identifier,$("#dataJSONImport").val(), dashboardExtension,$("#overwritecheck").is(":checked"),$("#importAuthcheck").is(":checked"));						
						
					}									
				}
			}
		});
	}
	
	function navigateUrl(url,reload){ 
		if(reload){
			window.location.reload();
			window.location.replace(url);
		}
		else{
			window.location.href = url;
		}
	}

	function importDashboard(name,data,extension,overwrite,importAuthcheck){
		if($("#jsonInputData").val()==="" || $("#newImportDashboard").val()===""){
			return;//Required params
		}
		
		console.log(name);
		console.log(extension);
		
		var url = "/controlpanel/dashboards/importDashboard?overwrite="+overwrite+"&importAuthorizations="+importAuthcheck;
			//Name inside notebook
			try {
				var jsonData = JSON.parse(data)
				jsonData.identification = name;
				data = JSON.stringify(jsonData);
			}catch(error) {
				$.alert({title: 'Error', theme: 'light',  content: /*[[#{dashboards.error.invalidformat}]]*/ 'Error' 
					}
				)
				}
			$.ajax({
			    contentType: 'application/json',
			    data: data,
			    dataType: 'json',
			    success: function(data){			    	
			    	navigateUrl("/controlpanel/dashboards/list/",true);
			    },
			    error: function(e){			    	
			    	if(e.statusCode().status==409){
						$.alert({title: 'Error', theme: 'light',  content: /*[[#{dashboards.error.duplicate}]]*/ 'Error'
							}
						)
						console.log("Error importing dashboard, message detail, " + " error: " + e.error + ", " + e.responseText);
					}
					else if (e.statusCode().status==400){
						$.alert({title: 'Error', theme: 'light',  content: /*[[#{dashboards.error.invalidformat}]]*/ 'Error'
							}
						)
						console.log("Error importing dashboard, message detail, " + " error: " + e.error + ", " + e.responseText);
					}
			    },
			    processData: false,
			    type: 'POST',
			    url: url
			});
			
   }
	
	function fileImportChange(jsonFile){
		var reader = new FileReader();
		reader.readAsText(jsonFile);
		var nameDashboard;
		reader.onload = function(data) {		
			nameDashboard = JSON.parse(data.target.result).name;
			$('#newImportDashboard').val(nameDashboard);
			$('#dataJSONImport').val(data.target.result);
			
		};
	}
	
	
	//]]>
	</script>
	
</body>
</html> 
